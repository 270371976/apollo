"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[579],{23240:(e,t,n)=>{n.r(t),n.d(t,{default:()=>$t});var r=n(48431),o=n(99063),i=n(52016),a=n(52274),l=n.n(a);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){var r,o,i,a;r=e,o=t,i=n[t],a=function(e,t){if("object"!=u(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==u(a)?a:String(a))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p=(0,r.createContext)(void 0),d=function(e){var t=e.initialPath,n=void 0===t?"/":t,o=e.children,i=f((0,r.useState)(n),2),a=i[0],l=i[1],u=(0,r.useMemo)((function(){return{currentPath:a,navigate:l}}),[a]);return r.createElement(p.Provider,{value:u},o)},y=function(e){var t=e.path,n=e.children,o=(0,r.useContext)(p);if(!o)throw new Error("Route must be used within SimpleRouter");return o.currentPath===t?r.createElement(r.Fragment,null,n):null},b=function(){var e=(0,r.useContext)(p);if(!e)throw new Error("useNavigate must be used within SimpleRouter");return e.navigate},v=function(e){var t=e.path,n=e.style,o=e.children,i=(0,r.useContext)(p);if(!i)throw new Error("KeepAlive must be used within SimpleRouter");var a=i.currentPath===t,l=f((0,r.useState)(!1),2),u=l[0],c=l[1];return(0,r.useEffect)((function(){a&&c(!0)}),[a]),u?r.createElement("div",{style:s(s({},n),{},{display:a?"block":"none"})},o):null},g=n(36242),h=n(46533),E=n(47960),w=n(15076),O=n(11446),S=n(38129),C={Perception:{polygon:{defaultVisible:!0,currentVisible:!0,vizKey:"polygon"},boundingbox:{defaultVisible:!1,currentVisible:!1,vizKey:"boundingbox"},pointCloud:{defaultVisible:!1,currentVisible:!1,vizKey:"pointCloud"},unknownMovable:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownMovable"},vehicle:{defaultVisible:!0,currentVisible:!0,vizKey:"vehicle"},unknownStationary:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownUnmovable"},pedestrian:{defaultVisible:!0,currentVisible:!0,vizKey:"pedestrian"},unknown:{defaultVisible:!0,currentVisible:!0,vizKey:"unknown"},bicycle:{defaultVisible:!0,currentVisible:!0,vizKey:"bicycle"},cipv:{defaultVisible:!0,currentVisible:!0,vizKey:"cipv"},velocity:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleVelocity"},heading:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleHeading"},id:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleId"},distanceAndSpeed:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleDistanceAndSpeed"},laneMarker:{defaultVisible:!1,currentVisible:!1,vizKey:"laneMarker"},lidarSensor:{defaultVisible:!1,currentVisible:!1,vizKey:"lidarSensor"},radarSensor:{defaultVisible:!1,currentVisible:!1,vizKey:"radarSensor"},cameraSensor:{defaultVisible:!1,currentVisible:!1,vizKey:"cameraSensor"},v2x:{defaultVisible:!1,currentVisible:!1,vizKey:"v2x"}},Prediction:{priority:{defaultVisible:!0,currentVisible:!0,vizKey:"obstaclePriority"},majorPredictionLine:{defaultVisible:!0,currentVisible:!0,vizKey:"majorPredictionLine"},gaussianInfo:{defaultVisible:!1,currentVisible:!1,vizKey:"gaussianInfo"},minorPredictionLine:{defaultVisible:!0,currentVisible:!0,vizKey:"minorPredictionLine"},interactiveTag:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleInteractiveTag"}},Routing:{routingLine:{defaultVisible:!0,currentVisible:!0,vizKey:"routingLine"}},Decision:{mainDecision:{defaultVisible:!0,currentVisible:!0,vizKey:"mainDecision"},obstacleDecision:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleDecision"}},Planning:{planningCar:{defaultVisible:!1,currentVisible:!1,vizKey:"planningCar"},planningTrajectoryLine:{defaultVisible:!0,currentVisible:!0,vizKey:"planningTrajectoryLine"},planningReferenceLine:{defaultVisible:!1,currentVisible:!1,vizKey:"PlanningReferenceLine"},planningBoundaryLine:{defaultVisible:!1,currentVisible:!1,vizKey:"PlanningBoundaryLine"}},Position:{localization:{defaultVisible:!0,currentVisible:!0,vizKey:"localization"},gps:{defaultVisible:!1,currentVisible:!1,vizKey:"gps"},shadow:{defaultVisible:!1,currentVisible:!1,vizKey:"shadow"}},Map:{crosswalk:{defaultVisible:!0,currentVisible:!0,vizKey:"crosswalk"},clearArea:{defaultVisible:!0,currentVisible:!0,vizKey:"clearArea"},junction:{defaultVisible:!1,currentVisible:!1,vizKey:"junction"},pncJunction:{defaultVisible:!1,currentVisible:!1,vizKey:"pncJunction"},lane:{defaultVisible:!0,currentVisible:!0,vizKey:"lane"},road:{defaultVisible:!1,currentVisible:!1,vizKey:"road"},signal:{defaultVisible:!0,currentVisible:!0,vizKey:"signal"},stopSign:{defaultVisible:!0,currentVisible:!0,vizKey:"stopSign"},yieldSign:{defaultVisible:!0,currentVisible:!0,vizKey:"yieldSign"},speedBump:{defaultVisible:!0,currentVisible:!0,vizKey:"speedBump"},parkingSpace:{defaultVisible:!0,currentVisible:!0,vizKey:"parkingSpace"},parkingSpaceId:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpaceId"},laneId:{defaultVisible:!1,currentVisible:!1,vizKey:"laneId"}}},P=function(e){var t={};return Object.keys(e).forEach((function(n){var r=e[n];Object.keys(r).forEach((function(e){var o=r[e];t[n]=t[n]||{},t[n][o.vizKey]=o.currentVisible}))})),t},A=new O.DT(O.qK.layerMenuParams),x=function(){return A.get()||C},j=n(83517),R=n(84436),k=n(1434);function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){M(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function M(e,t,n){var r;return r=function(e,t){if("object"!=N(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=N(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==N(r)?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function V(e){var t,n,o=(0,S.A)(),a=o.classes,l=o.cx,u=e.carviz,c=e.pointCloudFusionChannel,s=e.handlePointCloudVisible,f=e.pointcloudChannels,m=e.updatePointcloudChannel,p=e.curChannel,d=e.setCurChannel,y=e.handleReferenceLineVisible,b=e.handleBoundaryLineVisible,v=e.handleTrajectoryLineVisible,g=(0,E.Bd)("layerMenu").t,w=(0,j.d)().panelId,N=(0,R.A)().metadata,F=(0,r.useCallback)((function(e){if("pointCloud"===e){var t,n=null===(t=N.find((function(e){return e.dataName===h.lt.POINT_CLOUD})))||void 0===t?void 0:t.channels;if(Array.isArray(n)){var r=n.some((function(e){return e.channelName.includes("compensator")})),o=n.some((function(e){return e.channelName.includes("fusion")}));return!(r||o)}}return!1}),[N]),L=x();A.set(L),u.option.updateLayerOption(P(L),"vehicle");var V=I((0,r.useState)(L),2),D=V[0],_=V[1],z=I((0,r.useState)(Object.keys(D)),1)[0],K=I((0,r.useState)(z[0]),2),W=K[0],B=K[1],U=I((0,r.useState)(D[W]),2),Y=U[0],$=U[1],H=(0,r.useRef)(),G=(0,O.Mj)("".concat(w,"-viz-pointcloud-channel")),q=(0,r.useMemo)((function(){var e=(D[W].pointCloud||{}).currentVisible;return H.current=e,r.createElement("li",{className:a["layer-menu-content-right-li"],key:"pointCloud"},r.createElement("span",{className:a["layer-menu-content-right-switch"]},r.createElement(i.Sc,{checked:e,defaultChecked:e,onChange:function(e){var t=e.target.checked;H.current=t;var n=T(T({},D[W]),{},{pointCloud:T(T({},D[W].pointCloud),{},{currentVisible:t})}),r=T(T({},D),{},M({},W,n));$((function(){return n})),_((function(){return r})),u.option.updateLayerOption(P(r),"vehicle"),A.set(r),t&&s&&s(e.target.checked),t||s&&s(e.target.checked)}})),r.createElement("span",{className:a["layer-menu-content-right-label"]},g("pointCloud")))}),[u.option,F,a,W,s,D,c,g]);return r.createElement("div",{className:a["layer-menu-container"]},r.createElement("div",{className:a["layer-menu-header"]},r.createElement("div",{className:a["layer-menu-header-left"]},g("layerMenu")),r.createElement("div",{className:a["layer-menu-header-right"]},r.createElement("div",{className:a["layer-menu-header-reset-btn"],onClick:function(){_((function(){return C})),u.option.updateLayerOption(P(C),"vehicle"),A.set(C)}},g("restoreDefaultSettings")))),r.createElement("div",{className:a["layer-menu-content"]},r.createElement("div",{className:a["layer-menu-content-left"]},z.map((function(e){return r.createElement("li",{key:e,className:l(a["layer-menu-content-left-li"],M({},a["li-active"],W===e)),onClick:function(){B(e),$(D[e])}},r.createElement("span",null,g(e)))}))),r.createElement("div",{className:a["layer-menu-content-right"]},"Perception"===W&&r.createElement(r.Fragment,null,r.createElement("li",{className:a["layer-menu-content-right-li"]},r.createElement("span",{className:a["layer-menu-content-right-switch"]},r.createElement(i.sx,{checked:null==D||null===(t=D.Perception)||void 0===t||null===(t=t.polygon)||void 0===t?void 0:t.currentVisible,onChange:function(e){if(e.target.checked){var t=T(T({},D.Perception),{},{polygon:T(T({},D.Perception.polygon),{},{currentVisible:!0}),boundingbox:T(T({},D.Perception.boundingbox),{},{currentVisible:!1})}),n=T(T({},D),{},M({},W,t));$((function(){return t})),_((function(){return n})),u.option.updateLayerOption(P(n),"vehicle"),A.set(n)}}})),r.createElement("span",{className:a["layer-menu-content-right-label"]},g("polygon"))),r.createElement("li",{className:a["layer-menu-content-right-li"]},r.createElement("span",{className:a["layer-menu-content-right-switch"]},r.createElement(i.sx,{checked:null==D||null===(n=D.Perception)||void 0===n||null===(n=n.boundingbox)||void 0===n?void 0:n.currentVisible,onChange:function(e){if(e.target.checked){var t=T(T({},D.Perception),{},{polygon:T(T({},D.Perception.polygon),{},{currentVisible:!1}),boundingbox:T(T({},D.Perception.boundingbox),{},{currentVisible:!0})}),n=T(T({},D),{},M({},W,t));$((function(){return t})),_((function(){return n})),u.option.updateLayerOption(P(n),"vehicle"),A.set(n)}}})),r.createElement("span",{className:a["layer-menu-content-right-label"]},g("boundingbox"))),r.createElement("div",{className:a["layer-menu-horizontal-line"]})),q,r.createElement(k.A,{disabled:!H.current,value:p,options:f,onChange:function(e){return function(e){d(e),m(e),G.set(e)}(e)}}),r.createElement("div",{className:a["layer-menu-horizontal-line"]}),Object.keys(Y).map((function(e){if("pointCloud"===e)return null;var t=(D[W][e]||{}).currentVisible;return"polygon"!==e&&"boundingbox"!==e&&r.createElement("li",{className:a["layer-menu-content-right-li"],key:e},r.createElement("span",{className:a["layer-menu-content-right-switch"]},r.createElement(i.Sc,{checked:t,disabled:F(e),defaultChecked:t,onChange:function(t){var n=t.target.checked,r=T(T({},D[W]),{},M({},e,T(T({},D[W][e]),{},{currentVisible:n}))),o=T(T({},D),{},M({},W,r));$((function(){return r})),_((function(){return o})),u.option.updateLayerOption(P(o),"vehicle"),A.set(o),n&&"pointCloud"===e&&!F(e)&&c&&s&&s(t.target.checked),n||"pointCloud"!==e||s&&s(t.target.checked),"planningReferenceLine"===e&&y(n),"planningBoundaryLine"===e&&b(n),"planningTrajectoryLine"===e&&v(n)}})),r.createElement("span",{className:a["layer-menu-content-right-label"]},g(e)))})))))}const D=r.memo(V);var _=n(96676),z=n(2975),K=n(60346),W=n(60016);function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){var r,o,i,a;r=e,o=t,i=n[t],a=function(e,t){if("object"!=B(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=B(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==B(a)?a:String(a))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(){return(0,W.f2)((function(e){return{"routing-editing-op-area":Y({width:192,height:32,color:"#A6B5CC",borderRadius:6,position:"absolute",top:24,left:24},e.util.flex("row","space-between","center")),"routing-editing-btn":Y(Y({width:144,height:32,borderRadius:6,background:"#343C4D"},e.util.flexCenterCenter),{},{"&:hover":{cursor:"pointer",background:"#38465A",color:"#fff"}}),"routing-editing-btn__icon":{marginRight:6},"routing-editing-btn__text":{fontFamily:"PingFangSC-Regular",fontSize:14},"common-routing-editing-btn":Y(Y({width:32,minWidth:32,height:32,minHeight:32,background:"#343C4D",borderRadius:6},e.util.flexCenterCenter),{},{"&:hover":{cursor:"pointer",background:"#38465A",color:"#fff"}}),"common-routing-editing-btn__icon":{},"routing-editing-disable":{cursor:"not-allowed","& .routing-editing-btn-disable":{color:"#515761",pointerEvents:"none",background:"#383D47"},"& .common-routing-editing-btn-disbale":{color:"#515761",pointerEvents:"none",background:"#383D47"}},"routing-editing-btn-popover":{"& .dreamview-popover-inner-content":{padding:"5px 10px",fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400",borderRadius:"6px"},"& .dreamview-popover-arrow::after":{}},"common-routing-popover-ordinary":{"& .dreamview-popover-inner, & .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"}},"common-routing-popover-functional":{"& .dreamview-popover-inner,& .dreamview-popover-arrow::before, & .dreamview-popover-arrow::after":{color:"#A6B5CC !important",background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::before":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(40, 43, 54) !important"}}}}))()}var H=(0,r.forwardRef)((function(e,t){var n=e.onClick,o=$(),a=o.classes,l=o.cx,u=(0,E.Bd)("routeEditing").t;return r.createElement("div",{id:"routing-editing-btn",className:l(a["routing-editing-btn"],"routing-editing-btn-disable"),onClick:n,ref:t},r.createElement("i",{className:a["routing-editing-btn__icon"]},r.createElement(i.Oi,null)),r.createElement("div",{className:a["routing-editing-btn__text"]},u("routingEditing")))})),G=(0,r.forwardRef)((function(e,t){var n=e.onClick,o=$(),a=o.classes,l=o.cx;return r.createElement("div",{className:l(a["common-routing-editing-btn"],"common-routing-editing-btn-disbale"),onClick:n,ref:t},r.createElement("i",{className:a["common-routing-editing-btn__icon"]},r.createElement(i.gp,null)))}));H.displayName="RoutingEditingBtn",G.displayName="CommonRoutingEditingBtn";var q=n(50832),Z=n(77122),J=n(43158),X=n(27878),Q=n(91363);function ee(e){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(e)}function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(Object(n),!0).forEach((function(t){var r,o,i,a;r=e,o=t,i=n[t],a=function(e,t){if("object"!=ee(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=ee(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==ee(a)?a:String(a))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function re(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||oe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oe(e,t){if(e){if("string"==typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ie(e,t):void 0}}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ae(e){var t,n=e.EE,o=e.destroy,a=e.mainApi,l=e.panelContext,u=e.routeManager,c=e.routingEditor,s=e.isMainConnected,f=e.defaultRoutingList,m=e.createCommonRoutingSuccessFunctional,p=re(i.lV.useForm(),1)[0],d=(0,W.f2)((function(e){return{"routing-modal":{"& .dreamview-modal-wrap":{zIndex:"1040"},"& .dreamview-modal-mask":{zIndex:"1040"},"& .dreamview-modal-content":{width:"492px","& .dreamview-modal-body":{marginTop:"30px",label:{color:"#FFFFFF",fontFamily:"PingFangSC-Regular",fontWeight:"400"},"& .dreamview-form":{"& .ant-form-item":{marginBottom:"16px"},"& > div:nth-of-type(1)":{"& .ant-form-item-label":{"& label":{position:"relative",top:"4px"}}}}}},"& .dreamview-modal-footer":{display:"flex",justifyContent:"center",alignItems:"center","& > button":{width:"74px",height:"40px",borderRadius:"8px"},"& > button:nth-of-type(1)":{color:"#FFFFFF",background:"#282B36",border:"1px solid rgba(124,136,153,1)"},"& > button:nth-of-type(2)":{background:"#3288FA",borderRadius:"8px",marginLeft:"24px !important"}}},"routing-form-initial":{fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400",color:"#FFFFFF",marginLeft:"39px",marginBottom:"16px",display:"flex"},"routing-form-initial-content":{width:"320px",color:"#FFFFFF",display:"flex",justifyContent:"space-between"},"routing-form-initial-content-heading":{width:"111px"},"routing-form-way":{height:"264px",border:"1px solid rgba(56,59,69,1)",borderRadius:"8px",padding:"16px 0px 16px 45px",marginBottom:"12px"},"routing-form-way-con":{fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400",color:"#FFFFFF",display:"flex"},"routing-form-way-content":{flex:"1"},"routing-form-way-item":{color:"#FFFFFF",marginBottom:"8px",display:"flex",justifyContent:"space-between"},"routing-form-way-item-heading":{width:"111px"},"routing-form-colon":{color:"#A6B5CC",marginRight:"6px"},"routing-form-colon-distance":{marginLeft:"2px"},"routing-form-loop-disable":{background:"rgb(40, 93, 164)","& .dreamview-switch-handle":{background:"rgb(190, 206, 227)",borderRadius:"3px"}},"create-modal-form":{"& .ant-form-item-label":{"& label":{color:"#A6B5CC !important"}}}}}))(),y=(d.cx,d.classes),b=(0,E.Bd)("routeEditing").t,v=u.currentRouteMix,g=v.getCurrentRouteMix().currentRouteLoop.currentRouteLoopState,w=null===(t=v.getCurrentRouteMix().currentRouteLoop)||void 0===t?void 0:t.currentRouteLoopTimes,O=re((0,r.useState)([]),2),S=O[0],C=O[1],P=re((0,r.useState)({x:0,y:0}),2),A=P[0],x=P[1];return(0,r.useEffect)((function(){var e=c.initiationMarker.initiationMarkerPosition,t=c.pathwayMarker.pathWatMarkerPosition;e?x(e):a.getStartPoint().then((function(e){x({x:e.x,y:e.y,heading:null==e?void 0:e.heading})})),C(t)}),[s]),r.createElement(i.aF,{title:b("routeCreateCommonBtn"),okText:b("create"),cancelText:b("cancel"),open:!0,onOk:function(){p.validateFields().then((function(){if(s&&a){var e=p.getFieldsValue();if(e.loopRouting){var t=Number(e.cycleNumber);e.cycleNumber=t>10?10:t}delete e.loopRouting,a.saveDefaultRouting(ne(ne({},e),{},{routingType:h.D5.DEFAULT_ROUTING,point:[A].concat((r=S,function(e){if(Array.isArray(e))return ie(e)}(r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||oe(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))})).then((function(){n.emit(Q.u.SimControlRoute,{panelId:l.panelId,routeInfo:{initialPoint:A,wayPoint:S,cycleNumber:null==e?void 0:e.cycleNumber}}),m(),o(),(0,i.iU)({type:"success",content:b("createCommonRouteSuccess")})}))}var r}))},onCancel:function(){o()},rootClassName:y["routing-modal"]},r.createElement(i.lV,{form:p,name:"form",className:y["create-modal-form"],initialValues:{loopRouting:g,cycleNumber:w}},r.createElement(i.lV.Item,{label:b("name"),style:{marginLeft:"74px"},name:"name",rules:[function(e){return e.getFieldValue,{validator:function(e,t){return t?t&&f.find((function(e){return e.name===t}))?Promise.reject(new Error(b("alreadyExists"))):Promise.resolve():Promise.reject(new Error(b("pleaseEnter")))}}}]},r.createElement(i.pd,{placeholder:"Please enter",style:{width:"252px",height:"40px"}})),r.createElement("div",{className:y["routing-form-initial"]},r.createElement("div",{className:y["routing-form-colon"]},b("initialPoint"),r.createElement("span",{className:y["routing-form-colon-distance"]},":")),r.createElement("div",{className:y["routing-form-initial-content"]},r.createElement("div",null,"[".concat(A.x.toFixed(3)," ，").concat(A.y.toFixed(3),"]")),r.createElement("div",{className:y["routing-form-initial-content-heading"]},null!=A&&A.heading?A.heading.toFixed(3):"-"))),r.createElement(X.A,{className:y["routing-form-way"]},r.createElement("div",{className:y["routing-form-way-con"]},r.createElement("div",{className:y["routing-form-colon"]},b("wayPoint"),r.createElement("span",{className:y["routing-form-colon-distance"]},":")),r.createElement("div",{className:y["routing-form-way-content"]},null==S?void 0:S.map((function(e,t){return r.createElement("div",{key:"".concat(e.x).concat(e.y).concat(t+1),className:y["routing-form-way-item"]},r.createElement("div",null,"[".concat(e.x.toFixed(3),"，").concat(e.y.toFixed(3),"]")),r.createElement("div",{className:y["routing-form-way-item-heading"]},null!=e&&e.heading?e.heading.toFixed(3):"-"))}))))),g&&r.createElement(i.lV.Item,{label:b("loopRouting"),style:{marginLeft:"16px"},name:"loopRouting",valuePropName:"checked"},r.createElement(i.dO,{disabled:!0,className:y["routing-form-loop-disable"]})),g&&r.createElement(i.lV.Item,{label:b("setLooptimes"),style:{marginLeft:"11px"},name:"cycleNumber",rules:[function(e){return e.getFieldValue,{validator:function(e,t){return t?Number(t)>10?Promise.reject(new Error("Max loop times is 10")):Promise.resolve():Promise.reject(new Error("Please enter"))}}}]},r.createElement(i.YI,{type:"number",max:10,precision:0,disabled:!0}))))}var le=function(e){return e.EDITING_ROUTE="editing",e.CREATING_ROUTE="creating",e}({}),ue=function(e){return e.INITIAL_POINT="initial_point",e.WAY_POINT="way_point",e}({}),ce=n(29946),se=n(47127),fe="INIT_ROUTING_EDITOR",me="INIT_ROUTE_MANAGER",pe=ce.$7.createStoreProvider({initialState:{routingEditor:null,routeManager:null},reducer:function(e,t){return(0,se.jM)(e,(function(e){switch(t.type){case fe:e.routingEditor=t.payload.routingEditor;break;case me:e.routeManager=t.payload.routeManager}}))}}),de=pe.StoreProvider,ye=pe.useStore,be=n(27470),ve=n(1465);function ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||he(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function he(e,t){if(e){if("string"==typeof e)return Ee(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ee(e,t):void 0}}function Ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function we(e){var t=e.activeOrigin,n=e.destroyFunFavoriteNotFullScreen,o=(0,W.f2)((function(e){return{"favorite-scroll":{width:"284px",maxHeight:"402px",padding:"16px 16px"},"favorite-creating-op":{width:"252px",height:"40px",marginBottom:"10px"},"favorite-common-co":{"& > div:last-child":{borderBottom:"none"}},"favorite-common-item":{height:"40px",color:"#A6B5CC",fontSize:"14px",fontWeight:"400",fontFamily:"PingFangSC-Regular",borderBottom:"1px solid #383B45",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center","& .favorite-common-item-op-hover":{display:"none"},"&:hover":{width:"268px",background:"rgba(115,193,250,0.08)",borderRadius:"6px",margin:"0px -8px 0px -8px",padding:"0px 8px 0px 8px","& .favorite-common-item-op-no-hover":{display:"none"},"& .favorite-common-item-op-hover":{display:"block"}}},"favorite-common-item-active":{background:"#3288FA !important",borderRadius:"6px",margin:"0px -8px 0px -8px",padding:"0px 8px 0px 8px","& .favorite-common-item-name-cx":{color:"#FFFFFF"},"& .favorite-common-item-op-no-hover-val-cx":{background:"#3288FA"},"& .favorite-common-item-op-no-hover-title-cx":{color:"#FFFFFF !important"},"&: hover":{"& .favorite-common-item-op-hover":{display:"none"},"& .favorite-common-item-op-no-hover":{display:"block"}}},"favorite-common-item-op-no-hover-title":{color:"#808B9D"},"favorite-common-item-op-no-hover-val":{width:"18px",height:"18px",color:"#FFFFFF",fontSize:"12px",textAlign:"center",lineHeight:"18px",marginLeft:"4px",background:"#343C4D",borderRadius:"4px",display:"inline-block"},"favorite-common-item-op-hover-remove":{color:"#FFFFFF",marginLeft:"23px"},"favorite-common-item-name":{width:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},"favorite-warning-co":{padding:"14px 0px 32px 0px",display:"flex",flexDirection:"column",alignItems:"center"},"favorite-warning-co-desc":{width:"195px",color:"#A6B5CC",fontSize:"12px",fontWeight:"400",fontFamily:"PingFangSC-Regular"},"favorite-warning-co-desc-active":{color:"#3288FA",cursor:"pointer"}}}))(),a=o.cx,l=o.classes,u=(0,ve.ml)(),c=b(),s=(0,j.d)(),f=s.enterFullScreen,m=(0,E.Bd)("routeEditing").t,p=ge(ye(),1)[0],d=p.routeManager,y=p.routingEditor,v=d.currentRouteManager,g=(0,R.A)(),h=g.mainApi,w=g.isMainConnected,O=ge((0,r.useState)(null),2),S=O[0],C=O[1],P=ge((0,r.useState)([]),2),A=P[0],x=P[1],k=function(){w&&h.getDefaultRoutings().then((function(e){x(e.defaultRoutings.reverse())}))},N=(0,r.useCallback)((function(){t===be.uW.FROM_FULLSCREEN&&(y.pathwayMarker.positionsCount&&w?(0,J.A)({EE:u,mainApi:h,routeManager:d,routingEditor:y,panelContext:s,isMainConnected:w,defaultRoutingList:A,createCommonRoutingSuccessFunctional:k},ae):(0,i.iU)({type:"error",content:m("NoWayPointMessage")})),t===be.uW.FROM_NOT_FULLSCREEN&&(n(),c("/routing"),f())}),[u,h,A,d,y,s,t,d,w,c,f]);return(0,r.useEffect)((function(){w&&h.getDefaultRoutings().then((function(e){x(e.defaultRoutings.reverse())}))}),[w]),(0,r.useEffect)((function(){var e,t,n,r,o,i;C((e=A,t=v.getCurrentRoute(),o=[null==t||null===(n=t.routePoint)||void 0===n?void 0:n.routeInitialPoint].concat(function(e){if(Array.isArray(e))return Ee(e)}(i=(null==t||null===(r=t.routePoint)||void 0===r?void 0:r.routeWayPoint)||[])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(i)||he(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),e.find((function(e){return e.point.length===o.length&&e.point.every((function(e,t){var n,r,i;return(null==e?void 0:e.heading)===(null===(n=o[t])||void 0===n?void 0:n.heading)&&e.x===(null===(r=o[t])||void 0===r?void 0:r.x)&&e.y===(null===(i=o[t])||void 0===i?void 0:i.y)}))}))))}),[A]),(0,r.useEffect)((function(){t!==be.uW.FROM_NOT_FULLSCREEN&&w&&h.getStartPoint().then((function(e){var t={x:e.x,y:e.y,heading:null==e?void 0:e.heading},n=y.pathwayMarker.lastPosition;h.checkCycleRouting({start:t,end:n}).then((function(e){e.isCycle||d.currentRouteMix.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!1}})}))}))}),[w,t]),r.createElement(X.A,{className:l["favorite-scroll"]},t!==be.uW.FROM_NOT_FULLSCREEN&&r.createElement(i.$n,{className:l["favorite-creating-op"],onClick:N},m("routeCreateCommonBtn")),A.length?r.createElement("div",{className:l["favorite-common-co"]},A.map((function(e){return r.createElement("div",{key:e.name,onClick:function(){return function(e){C(e);var t=s.panelId,n=e.point[0],r=e.point.slice(1),o=null==e?void 0:e.cycleNumber,i={initialPoint:n,wayPoint:r,cycleNumber:o};d.currentRouteMix.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!!o,currentRouteLoopTimes:o}}),h.setStartPoint({point:n}).then((function(){v.setCurrentRoute({routeOrigin:le.CREATING_ROUTE,routePoint:{routeInitialPoint:n,routeWayPoint:r}}),u.emit(Q.u.SimControlRoute,{panelId:t,routeInfo:i})}))}(e)},className:a(l["favorite-common-item"],S&&S.name===e.name&&l["favorite-common-item-active"])},r.createElement("div",{className:a("favorite-common-item-name-cx",l["favorite-common-item-name"]),title:e.name},e.name),e.cycleNumber&&r.createElement("div",{className:a("favorite-common-item-op-no-hover")},r.createElement("span",{className:a("favorite-common-item-op-no-hover-title-cx",l["favorite-common-item-op-no-hover-title"])},m("looptimes")),r.createElement("span",{className:a("favorite-common-item-op-no-hover-val-cx",l["favorite-common-item-op-no-hover-val"])},e.cycleNumber)),r.createElement("div",{className:a("favorite-common-item-op-hover")},r.createElement("span",{onClick:(t=e.name,function(e){e.stopPropagation(),w&&h.deleteDefaultRouting(t).then((function(){h.getDefaultRoutings().then((function(e){x(e.defaultRoutings.reverse())}))}))}),className:a("favorite-common-item-op-hover-remove-cx",l["favorite-common-item-op-hover-remove"])},r.createElement(Z.A,null))));var t}))):r.createElement("div",{className:l["favorite-warning-co"]},r.createElement("img",{src:q,alt:"resource_empty"}),r.createElement("div",{className:l["favorite-warning-co-desc"]},"".concat(m("createRouteToolTip"),","),r.createElement("span",{className:l["favorite-warning-co-desc-active"],onClick:N},m("goToCreate")))))}const Oe=r.memo(we);function Se(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ce(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Pe(){var e=$(),t=e.classes,n=e.cx,o=b(),a=Se((0,g.qZ)(),1)[0],l=(0,j.d)().enterFullScreen,u=(0,E.Bd)("routeEditing").t,c={popoverDisableText:u("routeEditingBtnOther")},s=Se((0,r.useState)(!1),2),f=s[0],m=s[1],p=Se((0,r.useState)(!1),2),d=p[0],y=p[1],v=Se((0,r.useState)(!0),2),h=v[0],w=v[1],O=r.createElement(Oe,{activeOrigin:be.uW.FROM_NOT_FULLSCREEN,destroyFunFavoriteNotFullScreen:function(){y(!1)}}),S=(0,r.useCallback)((function(){l(),setTimeout((function(){o("/routing")}))}),[l,o]);return(0,r.useEffect)((function(){a.currentOperation===g.D8.PLAY_RECORDER||a.currentOperation===g.D8.SCENARIO||a.currentOperation===g.D8.SIM_CONTROL||a.currentOperation===g.D8.AUTO_DRIVE?w(!1):w(!0)}),[a]),r.createElement("div",{className:n(h&&t["routing-editing-disable"],t["routing-editing-op-area"])},h?r.createElement(r.Fragment,null,r.createElement(i.AM,{content:null==c?void 0:c.popoverDisableText,trigger:"hover",placement:"top",rootClassName:t["routing-editing-btn-popover"]},r.createElement(r.Fragment,null,r.createElement(H,{onClick:S}))),r.createElement(i.AM,{content:null==c?void 0:c.popoverDisableText,trigger:"hover",placement:"top",rootClassName:t["routing-editing-btn-popover"]},r.createElement(r.Fragment,null,r.createElement(G,null)))):r.createElement(r.Fragment,null,r.createElement(H,{onClick:S}),r.createElement(i.AM,{content:u("routeCreateCommonBtn"),trigger:"hover",placement:"top",open:f,onOpenChange:function(e){m(e),y(!1)},rootClassName:t["routing-editing-btn-popover"]},r.createElement(i.AM,{content:O,trigger:"click",placement:"rightTop",open:d,onOpenChange:function(e){m(!1),y(e)},destroyTooltipOnHide:!0},r.createElement(r.Fragment,null,r.createElement(G,null))))))}var Ae=n(4611),xe=n(75508),je=function(e){return e.DEFAULT="Default",e.OVERHEAD="Overhead",e.MAP="Map",e.NEAR="Near",e.TOP_DOWN="TopDown",e}({}),Re=function(e){return e.DEFAULT="Default",e.FOLLOW="Follow",e}({});function ke(e){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ke(e)}function Ne(){return Ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ne.apply(this,arguments)}function Fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(n),!0).forEach((function(t){var r,o,i,a;r=e,o=t,i=n[t],a=function(e,t){if("object"!=ke(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=ke(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==ke(a)?a:String(a))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Me(e){var t=(0,W.f2)((function(e){return{"custom-popover":{"&.dreamview-popover .dreamview-popover-inner":{padding:0},"& .dreamview-popover-inner, & .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8)"},"& .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8)"},"& .dreamview-popover-content .dreamview-popover-inner .dreamview-popover-inner-content":Te({},e.tokens.typography.content)}}}))(),n=t.classes;return t.cx,r.createElement(i.AM,Ne({},e,{rootClassName:"".concat(n["custom-popover"]," ").concat(e.rootClassName||"")}))}const Ie=r.memo(Me);function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}function Ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(n),!0).forEach((function(t){var r,o,i,a;r=e,o=t,i=n[t],a=function(e,t){if("object"!=Le(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Le(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==Le(a)?a:String(a))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _e(e){return(0,W.f2)((function(e,t){return{"routing-editing-function-area":De({width:32,position:"absolute",top:25,left:24},e.util.flex("column","space-around","center")),"routing-editing-function-area__group":{background:"#343C4D",borderRadius:6,marginBottom:10},"routing-editing-functional__item":De(De({width:32,minWidth:32,height:32,minHeight:32,background:"#343C4D",borderRadius:6},e.util.flexCenterCenter),{},{"&:hover":{cursor:"pointer",background:"#38465A"}}),"hover-color-change":{"&:hover":{color:"#fff"}},"routing-editing-functional__item--active":{color:"#3388FA"},"routing-editing-functional__icon":{},"custom-popover-ordinary":{"& .dreamview-popover-inner, & .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"}},"custom-popover-functinal":{"& .dreamview-popover-inner,& .dreamview-popover-arrow::before, & .dreamview-popover-arrow::after":{color:"#A6B5CC !important",background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::before":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(40, 43, 54) !important"}},"routing-editing-functional__item--disable":{cursor:"not-allowed","&:hover":{cursor:"not-allowed"}}}}))(e)}function ze(e){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ze(e)}function Ke(e,t,n){var r;return r=function(e,t){if("object"!=ze(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=ze(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==ze(r)?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function We(e,t){var n=e.functionalName,o=e.checkedItem,a=e.onClick,l=e.disable,u=(0,r.useMemo)((function(){return o===n}),[n,o]),c=_e({}),s=c.classes,f=c.cx,m=(0,r.useMemo)((function(){switch(n){case be.Ay.RELOCATE:return r.createElement("i",null,r.createElement(i.Po,null));case be.Ay.WAYPOINT:return r.createElement("i",null,r.createElement(i.XI,null));case be.Ay.LOOP:return r.createElement("i",null,r.createElement(i.G0,null));case be.Ay.FAVORITE:return r.createElement("i",null,r.createElement(i.gp,null));default:return null}}),[n]);return r.createElement("div",{ref:t,className:f(s["routing-editing-functional__item"],Ke(Ke(Ke({},s["routing-editing-functional__item--active"],u),s["hover-color-change"],!u),s["routing-editing-functional__item--disable"],l)),onClick:a},r.createElement("div",{className:s["routing-editing-functional__icon"]},m))}const Be=(0,r.forwardRef)(We);var Ue=function(e){return e.FunctionalRelocateNoActive="initialPoint",e.FunctionalRelocateNoActiveDis="Inial Point is only available for simulation",e.FunctionaWayNoActive="wayPoint",e.FunctionalLoopNoActive="loopRouting",e.FunctionalFavoriteNoActive="commonRouting",e}({});function Ye(e){var t=e.functionalItemNoActiveText,n=(0,W.f2)((function(e){return{"routing-editing-item-no-active":{padding:"5px 10px",color:"#FFFFFF",fontSize:"14px",fontWeight:"400",fontFamily:"PingFangSC-Regular"}}}))(),o=n.classes,i=(n.cx,(0,E.Bd)("routeEditing").t);return r.createElement("div",{className:o["routing-editing-item-no-active"]},i(t))}function $e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return He(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?He(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ge(e){var t=(0,W.f2)((function(e){return{"functional-initial-con":{display:"flex"},"functional-initial-every-icon-con":{cursor:"not-allowed"},"functional-initial-disable":{"& .functional-initial-every-icon-disable":{color:"#40454D",pointerEvents:"none"}},"functional-initial-popover":{"& .dreamview-popover-inner-content":{padding:"5px 10px",color:"#FFFFFF",fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400"}},"functional-initial-every-icon":{width:"32px",height:"32px",color:"#A6B5CC",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#D8D8D8",background:"rgba(115,193,250,0.08)"}}}}))(),n=t.classes,o=t.cx,a=$e(ye(),1)[0].routingEditor,l=(0,E.Bd)("routeEditing").t,u=(0,R.A)(),c=u.isMainConnected,s=u.mainApi,f=$e((0,r.useState)(a.initiationMarker.positionsCount),2),m=f[0],p=f[1],d=$e((0,r.useState)(!(m>0)),2),y=d[0],b=d[1];return(0,r.useEffect)((function(){b(!m)}),[m]),r.createElement("div",{className:o(y&&n["functional-initial-disable"],n["functional-initial-con"])},r.createElement(i.AM,{content:l("backToLastPoint"),trigger:"hover",rootClassName:n["functional-initial-popover"]},r.createElement("div",{className:y&&o(n["functional-initial-every-icon-con"])},r.createElement("div",{className:o("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){var e=a.initiationMarker.undo();c&&(e?s.setStartPoint({point:e}).then((function(){p(a.initiationMarker.positionsCount)})):s.setResetPoint().then((function(){p(a.initiationMarker.positionsCount)})))}},r.createElement(i.uy,null)))),r.createElement(i.AM,{content:l("backToStartPoint"),trigger:"hover",rootClassName:n["functional-initial-popover"]},r.createElement("div",{className:y&&o(n["functional-initial-every-icon-con"])},r.createElement("div",{className:o("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){c&&s.setResetPoint().then((function(){a.initiationMarker.reset(),p(a.initiationMarker.positionsCount)}))}},r.createElement(i.Ce,null)))))}function qe(e){return qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qe(e)}function Ze(e,t,n){var r;return r=function(e,t){if("object"!=qe(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=qe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==qe(r)?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Je(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Xe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qe(e){var t=(0,W.f2)((function(e){return{"functional-initial-con":{display:"flex"},"functional-initial-every-icon-con":{cursor:"not-allowed"},"functional-initial-disable":{"& .functional-initial-every-icon-disable":{color:"#40454D",pointerEvents:"none"}},"functional-initial-popover":{"& .dreamview-popover-inner-content":{padding:"5px 10px",color:"#FFFFFF",fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400"}},"functional-initial-every-icon":{width:"32px",height:"32px",color:"#A6B5CC",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#D8D8D8",background:"rgba(115,193,250,0.08)"}}}}))(),n=t.classes,o=t.cx,a=Je(ye(),1)[0].routingEditor,l=(0,E.Bd)("routeEditing").t,u=Je((0,r.useState)(a.pathwayMarker.positionsCount),2),c=u[0],s=u[1],f=Je((0,r.useState)(!(c>0)),2),m=f[0],p=f[1];return(0,r.useEffect)((function(){p(!c)}),[c]),r.createElement("div",{className:o(Ze({},n["functional-initial-disable"],m),n["functional-initial-con"])},r.createElement(i.AM,{content:l("removeLastPoint"),trigger:"hover",rootClassName:n["functional-initial-popover"]},r.createElement("div",{className:o(Ze({},n["functional-initial-every-icon-con"],m))},r.createElement("div",{className:o("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){a.pathwayMarker.undo(),s(a.pathwayMarker.positionsCount)}},r.createElement(i.uy,null)))),r.createElement(i.AM,{content:l("removeAllPoints"),trigger:"hover",rootClassName:n["functional-initial-popover"]},r.createElement("div",{className:o(Ze({},n["functional-initial-every-icon-con"],m))},r.createElement("div",{className:o("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){a.pathwayMarker.reset(),s(a.pathwayMarker.positionsCount)}},r.createElement(i.oh,null)))))}function et(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return tt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function nt(e){var t=(0,W.f2)((function(e){return{"functional-loop-con":{width:"257px",padding:"16px 0px 21px 0px",color:"#A6B5CC",fontSize:"14px",fontWeight:"400",fontFamily:"PingFangSC-Regular"},"functional-loop-switch":{width:"160px",height:"20px",margin:"0px 0px 0px 32px",display:"flex",justifyContent:"space-around",alignItems:"center"},"functional-loop-switch-help":{"& .dreamview-popover-arrow::before":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-inner-content":{width:"302px",color:"#FFFFFF",fontSize:"14px",fontWeight:"400",padding:"5px 10px",borderRadius:"6px",fontFamily:"PingFangSC-Regular",background:"rgba(80, 88, 102, 0.8)"}},"functional-loop-switch-remind":{position:"relative",top:"2px"},"functional-loop-input":{height:"32px",margin:"16px 0px 0px 20px",display:"flex",alignItems:"center"},"functional-loop-input-text":{marginRight:"6px"}}}))(),n=t.classes,o=(t.cx,et(ye(),1)[0].routeManager),a=(0,E.Bd)("routeEditing").t,l=o.currentRouteMix,u=l.getCurrentRouteMix(),c=et((0,r.useState)(u.currentRouteLoop.currentRouteLoopState),2),s=c[0],f=c[1];return r.createElement("div",{className:n["functional-loop-con"]},r.createElement("div",{className:n["functional-loop-switch"]},r.createElement("div",null,"".concat(a("loopRouting"),":")),r.createElement("div",null,r.createElement(i.dO,{onChange:function(e){e?l.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!0,currentRouteLoopTimes:1}}):l.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!1}}),f(e)},checked:s})),r.createElement(i.AM,{content:a("loopRoutingHelp"),trigger:"hover",placement:"top",rootClassName:n["functional-loop-switch-help"]},r.createElement("div",{className:n["functional-loop-switch-remind"]},r.createElement(i.Ad,null)))),s&&r.createElement("div",{className:n["functional-loop-input"]},r.createElement("div",{className:n["functional-loop-input-text"]},"".concat(a("setLooptimes"),":")),r.createElement("div",null,r.createElement(i.YI,{min:1,max:10,precision:0,onChange:function(e){l.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!0,currentRouteLoopTimes:e}})},defaultValue:l.getCurrentRouteMix().currentRouteLoop.currentRouteLoopTimes}))))}function rt(e){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rt(e)}function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function it(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){at(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function at(e,t,n){var r;return r=function(e,t){if("object"!=rt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=rt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==rt(r)?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ut(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ut(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ct(e){var t=e.carviz,n=e.changeActiveName,o=e.activeName,a=lt((0,g.qZ)(),2),l=a[0],u=(a[1],lt(ye(),1)[0]),c=u.routeManager,s=u.routingEditor,f=(0,R.A)(),m=f.isMainConnected,p=f.mainApi,d=(0,E.Bd)("routeEditing").t,y=c.currentRouteMix,b=lt((0,r.useState)(null),2),v=b[0],h=b[1],w=l.currentOperation===g.D8.AUTO_DRIVE,O=_e({relocateDisState:w}),S=O.classes,C=O.cx,P=(0,r.useCallback)((function(e,n){var r={routeOrigin:le.EDITING_ROUTE,routePoint:{routeInitialPoint:t.initiationMarker.initiationMarkerPosition,routeWayPoint:t.pathwayMarker.pathWatMarkerPosition}};if(n)if("lastPosition"in n){var o,i,a=n.lastPosition;"edit"===e&&(null===(i=c.currentRouteManager)||void 0===i||i.setScribeCurrentCheckPoint(it(it({},a),{},{type:ue.WAY_POINT}))),null===(o=c.currentRouteManager)||void 0===o||o.setCurrentRoute(r)}else{var l,u;"edit"===e&&(null===(u=c.currentRouteManager)||void 0===u||u.setScribeCurrentCheckPoint(it(it({},n),{},{type:ue.INITIAL_POINT}))),null===(l=c.currentRouteManager)||void 0===l||l.setCurrentRoute(r)}}),[t.initiationMarker,t.pathwayMarker,c.currentRouteManager]);(0,r.useEffect)((function(){Object.values(be.e_).includes(o)&&([be.e_.RELOCATE,be.e_.WAYPOINT].includes(o)||h(null))}),[o,t]),(0,r.useEffect)((function(){var e=function(e){"r"===e.key&&v!==be.Ay.RELOCATE&&(null==t||t.deactiveAll(),h(be.Ay.RELOCATE),null==n||n(be.e_.RELOCATE),null==t||t.initiationMarker.active(P)),"w"===e.key&&v!==be.Ay.WAYPOINT&&(null==t||t.deactiveAll(),h(be.Ay.WAYPOINT),null==n||n(be.e_.WAYPOINT),null==t||t.pathwayMarker.active(P)),(e.ctrlKey||e.metaKey)&&"z"===e.key&&(v===be.Ay.RELOCATE&&(null==t||t.initiationMarker.undo()),v===be.Ay.WAYPOINT&&(null==t||t.pathwayMarker.undo()))};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[v]);var A=(0,r.useCallback)((function(e){return function(){if(e!==be.Ay.RELOCATE||!w){if(v===e)return Object.values(be.e_).includes(e)&&(null==t||t.deactiveAll()),void h(null);switch(e){case be.Ay.RELOCATE:h(e),null==t||t.deactiveAll(),null==n||n(be.e_.RELOCATE),null==t||t.initiationMarker.active(P);break;case be.Ay.WAYPOINT:h(e),null==t||t.deactiveAll(),null==n||n(be.e_.WAYPOINT),null==t||t.pathwayMarker.active(P);break;case be.Ay.LOOP:s.pathwayMarker.positionsCount>0?m&&p.getStartPoint().then((function(n){var r={x:n.x,y:n.y,heading:null==n?void 0:n.heading},o=s.pathwayMarker.lastPosition;p.checkCycleRouting({start:r,end:o}).then((function(n){n.isCycle?(h(e),null==t||t.deactiveAll()):(y.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!1}}),(0,i.iU)({type:"error",content:d("NoLoopMessage")}))}))})):(0,i.iU)({type:"error",content:d("NoWayPointMessage")});break;case be.Ay.FAVORITE:h(e),null==t||t.deactiveAll()}}}}),[t,n,v]),x=v===be.Ay.RELOCATE?r.createElement(Ge,null):r.createElement(Ye,{functionalItemNoActiveText:w?Ue.FunctionalRelocateNoActiveDis:Ue.FunctionalRelocateNoActive}),j=v===be.Ay.WAYPOINT?r.createElement(Qe,null):r.createElement(Ye,{functionalItemNoActiveText:Ue.FunctionaWayNoActive}),k=v===be.Ay.LOOP?r.createElement(nt,null):r.createElement(Ye,{functionalItemNoActiveText:Ue.FunctionalLoopNoActive}),N=v===be.Ay.FAVORITE?r.createElement(Oe,{activeOrigin:be.uW.FROM_FULLSCREEN}):r.createElement(Ye,{functionalItemNoActiveText:Ue.FunctionalFavoriteNoActive});return r.createElement("div",{className:S["routing-editing-function-area"]},r.createElement("div",{className:S["routing-editing-function-area__group"]},r.createElement(Ie,{content:x,trigger:"hover",placement:"right",mouseLeaveDelay:.5,destroyTooltipOnHide:!0,rootClassName:C(v===be.Ay.RELOCATE?S["custom-popover-functinal"]:S["custom-popover-ordinary"])},r.createElement("div",{className:C(at({},S["func-relocate-ele"],w))},r.createElement(Be,{functionalName:be.Ay.RELOCATE,checkedItem:v,onClick:A(be.Ay.RELOCATE),disable:w}))),r.createElement(Ie,{content:j,trigger:"hover",placement:"right",mouseLeaveDelay:.5,destroyTooltipOnHide:!0,rootClassName:C(v===be.Ay.WAYPOINT?S["custom-popover-functinal"]:S["custom-popover-ordinary"])},r.createElement("div",null,r.createElement(Be,{functionalName:be.Ay.WAYPOINT,checkedItem:v,onClick:A(be.Ay.WAYPOINT)}))),r.createElement(Ie,{content:k,trigger:"hover",placement:"right",mouseLeaveDelay:.5,destroyTooltipOnHide:!0,rootClassName:C(v===be.Ay.LOOP?S["custom-popover-functinal"]:S["custom-popover-ordinary"])},r.createElement("div",null,r.createElement(Be,{functionalName:be.Ay.LOOP,checkedItem:v,onClick:A(be.Ay.LOOP)})))),r.createElement(Ie,{content:N,trigger:"hover",placement:"rightTop",destroyTooltipOnHide:!0,rootClassName:C(v===be.Ay.FAVORITE?S["custom-popover-functinal"]:S["custom-popover-ordinary"])},r.createElement("div",null,r.createElement(Be,{functionalName:be.Ay.FAVORITE,checkedItem:v,onClick:A(be.Ay.FAVORITE)}))))}const st=r.memo(ct);var ft=function(e){return{type:fe,payload:e}},mt=function(e){return{type:me,payload:e}};function pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function dt(){var e,t,n=(0,ve.ml)(),o=b(),a=(0,W.f2)((function(e){return{"routing-editing-op-con":{"& > button:nth-of-type(1)":{width:"72px",height:"32px",marginRight:"16px",backgroundColor:"transparent",border:"1px solid rgba(124,136,153,1)","&:hover":{color:"#3288FA",backgroundColor:"transparent",border:"1px solid #3288FA"},"&:active":{color:"#1252C0",backgroundColor:"#1252C0",border:"1px solid #1252C0"}},"& > button:nth-of-type(2)":{width:"114px",height:"32px"}}}}))(),l=a.classes,u=(a.cx,(0,j.d)()),c=(0,R.A)().mainApi,s=(e=ye(),t=1,function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return pt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],f=s.routingEditor,m=s.routeManager,p=(0,E.Bd)("routeEditing").t;return r.createElement("div",{className:l["routing-editing-op-con"]},r.createElement(i.$n,{onClick:function(){i.aF.confirm({content:p("cancelEditingRouting"),icon:r.createElement("span",null),onOk:function(){o("/"),u.exitFullScreen()},okText:p("modalConfirmYes"),cancelText:p("modalConfirmNo")})}},p("cancel")),r.createElement(i.$n,{onClick:function(){var e,t=u.panelId,r=f.initiationMarker.initiationMarkerPosition,i={initialPoint:r,wayPoint:f.pathwayMarker.pathWatMarkerPosition,cycleNumber:null===(e=m.currentRouteMix.getCurrentRouteMix().currentRouteLoop)||void 0===e?void 0:e.currentRouteLoopTimes};r||c.getStartPoint().then((function(e){i.initialPoint=e})),m.currentRouteMix.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!1}}),n.emit(Q.u.SimControlRoute,{panelId:t,routeInfo:i}),o("/"),u.exitFullScreen()}},p("saveEditing")))}function yt(e){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yt(e)}function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(n),!0).forEach((function(t){var r,o,i,a;r=e,o=t,i=n[t],a=function(e,t){if("object"!=yt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=yt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==yt(a)?a:String(a))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function gt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ht(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ht(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Et(){var e=(0,E.Bd)("routeEditing").t,t=gt(ye(),2),n=t[0].routeManager,a=t[1],u=n.currentRouteManager,c=(0,j.d)().registerFullScreenHooks,s=(0,R.A)(),f=s.mainApi,m=s.isMainConnected,p=gt((0,r.useState)(l().generate),1)[0],d=gt((0,r.useState)((function(){return new o.m(p)})),1)[0],y=gt((0,r.useState)((function(){return new Ae.A})),1)[0],v=gt((0,r.useState)(null),2),h=v[0],w=v[1],O=function(e){h!==e&&w(e)},C=(0,S.A)().classes,P=gt((0,g.qZ)(),1)[0],A=b();(0,r.useEffect)((function(){c({afterExitFullScreen:function(){A("/")}})}),[]),(0,r.useEffect)((function(){d.init(),d.view.changeViewType(je.MAP,!1),a(ft({routingEditor:d}))}),[]);var x=(0,r.useCallback)((function(e){var t,n;null==f||f.getMapElementIds({point:{x:null!==(t=e.x)&&void 0!==t?t:0,y:null!==(n=e.y)&&void 0!==n?n:0},radius:400}).then((function(e){if(!Ae.A.isMapElementIdsEmpty(e)){var t=gt(y.getMapElement(e),2),n=(t[0],t[1]);f.getMapElementsByIds(n).then((function(e){y.updateMapElement(e),null==d||d.updateMap(y.getAllMapElements()),d.render()}))}}))}),[m]);return(0,r.useEffect)((function(){var e;return d.removeAll(),d.deactiveAll(),y.clear(),null==f||f.getMapElementIds({radius:200}).then((function(t){var r=gt(y.getMapElement(t),2),o=(r[0],r[1]);f.getMapElementsByIds(o).then((function(t){if(y.updateMapElement(t),Ae.A.findFirstMapElement(o))try{null==d||d.updateMap(t),d.render(),d.setCameraUpdateCallback(x),null==f||f.getStartPoint().then((function(t){d.coordinates.initialize(t.x,t.y),d.initiationMarker.init(t),x(new xe.Vector3(t.x,t.y,0)),e=n.currentRouteManager.subScribeCurrentRoute((function(e){var t=e.routeOrigin,n=e.routePoint;if(t===le.CREATING_ROUTE){var r=n.routeInitialPoint,o=n.routeWayPoint;d.initiationMarker.init(r),d.pathwayMarker.init(o)}}))}))}catch(e){console.error("getMapElementById error",e)}}))})),function(){var t;null===(t=e)||void 0===t||t.unsubscribe()}}),[m,P.currentMap]),(0,r.useEffect)((function(){var t=u.subScribeCurrentCheckPoint((function(t){if(m){var n=t,r=t.type;delete n.type,f.checkRoutingPoint({point:vt(vt({},n),{},{id:0})}).then((function(t){t.isLegal?r===ue.INITIAL_POINT&&f.setStartPoint({point:vt({},n)}):(r===ue.INITIAL_POINT&&(d.initiationMarker.undo(),(0,i.iU)({type:"error",content:e("checkStartPointTooltip")})),r===ue.WAY_POINT&&(d.pathwayMarker.undo(),(0,i.iU)({type:"error",content:e("checkPointTooltip")})))}))}}));return function(){t.unsubscribe()}}),[m]),r.createElement("div",{className:C["viz-container"]},r.createElement("div",{id:p,className:C["web-gl"]}),r.createElement(st,{carviz:d,activeName:h,changeActiveName:O}),r.createElement("div",{className:C["view-btn-container"]},r.createElement(z.A,{carviz:d,activeName:h,changeActiveName:O})),r.createElement("div",{className:C["view-ope-container"]},r.createElement(dt,null)))}var wt=n(74633),Ot=n(23110);function St(e){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},St(e)}function Ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Pt(r.key),r)}}function Pt(e){var t=function(e,t){if("object"!=St(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=St(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==St(t)?t:String(t)}var At=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentRouteSubject=new wt.t(t),this.currentCheckPointSubject=new Ot.B}var t,n;return t=e,(n=[{key:"getCurrentRoute",value:function(){return this.currentRouteSubject.value}},{key:"setCurrentRoute",value:function(e){this.currentRouteSubject.next(e)}},{key:"subScribeCurrentRoute",value:function(e){return this.currentRouteSubject.subscribe(e)}},{key:"setScribeCurrentCheckPoint",value:function(e){this.currentCheckPointSubject.next(e)}},{key:"subScribeCurrentCheckPoint",value:function(e){return this.currentCheckPointSubject.subscribe(e)}}])&&Ct(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function xt(e){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xt(e)}function jt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Rt(r.key),r)}}function Rt(e){var t=function(e,t){if("object"!=xt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=xt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==xt(t)?t:String(t)}var kt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentRouteLoop=t.currentRouteLoop}var t,n;return t=e,(n=[{key:"getCurrentRouteMix",value:function(){return{currentRouteLoop:this.currentRouteLoop}}},{key:"setCurrentRouteMix",value:function(e){e.currentRouteLoop&&(this.currentRouteLoop=e.currentRouteLoop)}}])&&jt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Nt(e){return Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nt(e)}function Ft(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Mt(r.key),r)}}function Tt(e,t,n){return t&&Ft(e.prototype,t),n&&Ft(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Mt(e){var t=function(e,t){if("object"!=Nt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Nt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Nt(t)?t:String(t)}var It=Tt((function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentRouteManager=new At(t),this.currentRouteMix=new kt(n)})),Lt=n(7629);function Vt(e){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vt(e)}function Dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _t(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dt(Object(n),!0).forEach((function(t){var r,o,i,a;r=e,o=t,i=n[t],a=function(e,t){if("object"!=Vt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Vt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==Vt(a)?a:String(a))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Kt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Wt(){var e,t,n,a,u,c,s=(0,S.A)().classes,f=zt((0,g.qZ)(),1)[0],m=(0,r.useRef)(-1),p=(0,j.d)(),d=zt((0,r.useState)(l().generate),1)[0],y=zt((0,r.useState)((function(){return new o.o(d)})),1)[0],b=(0,r.useRef)([0,0]),v=zt((0,O.Vc)(O.qK.CurrentSwitchView,"Default"),2),C=v[0],k=v[1],N=(0,R.A)(),F=N.mainApi,T=N.streamApi,M=N.isMainConnected,I=p.logger,L=p.panelId,V=p.subscribeToData,K=p.updateChannel,W=p.setKeyDownHandlers,B=p.removeKeyDownHandlers,U=(0,E.Bd)("panels").t,Y=zt((0,Lt.h)(),2),$=(Y[0],Y[1],zt((0,r.useState)(x().Perception.pointCloud.currentVisible),2)),H=$[0],G=$[1],q=zt((0,r.useState)(null),2),Z=q[0],J=q[1],X=zt((0,r.useState)(null!==(e=null===(t=x().Planning.planningBoundaryLine)||void 0===t?void 0:t.currentVisible)&&void 0!==e&&e),2),Q=X[0],ee=X[1],te=zt((0,r.useState)(null!==(n=null===(a=x().Planning.planningReferenceLine)||void 0===a?void 0:a.currentVisible)&&void 0!==n&&n),2),ne=te[0],re=te[1],oe=zt((0,r.useState)(null!==(u=null===(c=x().Planning.planningTrajectoryLine)||void 0===c?void 0:c.currentVisible)&&void 0!==u&&u),2),ie=oe[0],ae=oe[1],le=(0,r.useMemo)((function(){return f.currentOperation===g.D8.WAYPOINT_FOLLOW?Re.FOLLOW:Re.DEFAULT}),[f.currentOperation]),ue=zt((0,r.useState)(le),2),ce=ue[0],se=ue[1],fe=(0,r.useRef)(),me=(0,r.useRef)(null),pe=(0,r.useRef)(null),de=function e(){y.render(),fe.current=requestAnimationFrame(e)},ye=function(){null==y||y.updateData({object:[],autoDrivingCar:{}}),null==y||y.render(),null!=pe&&pe.current&&pe.current.unsubscribe(),me.current&&me.current.subscription&&(me.current.subscription.unsubscribe(),me.current=null)};(0,r.useEffect)((function(){se(le)}),[le]),(0,r.useEffect)((function(){y.init();var e=x();A.set(e),y.option.updateLayerOption(P(e),"vehicle"),e.Perception.pointCloud.currentVisible&&setTimeout((function(){K({name:h.lt.POINT_CLOUD,needChannel:!1})}),0)}),[]),(0,r.useEffect)((function(){var e=[{keys:["="],functionalKey:"ctrlKey",handler:function(e){var t;e.preventDefault(),null===(t=y.view)||void 0===t||t.updateViewDistance(-10)},discriptor:U("zoomIn")},{keys:["="],functionalKey:"metaKey",handler:function(e){var t;e.preventDefault(),null===(t=y.view)||void 0===t||t.updateViewDistance(-10)},discriptor:U("zoomIn")},{keys:["-"],functionalKey:"ctrlKey",handler:function(e){var t;e.preventDefault(),null===(t=y.view)||void 0===t||t.updateViewDistance(10)},discriptor:U("zoomOut")},{keys:["-"],functionalKey:"metaKey",handler:function(e){var t;e.preventDefault(),null===(t=y.view)||void 0===t||t.updateViewDistance(10)},discriptor:U("zoomOut")}];return W(e),function(){B(e)}}),[U]);var be=function(e){var t,n,r,o=_t({},e),i=null,a=(null==o||null===(t=o.planningData)||void 0===t?void 0:t.path)||[];return Array.isArray(null==o||null===(n=o.planningData)||void 0===n?void 0:n.path)?(Q||(i=["planning_path_boundary_1_regular/self","candidate_path_regular/self","planning_path_boundary_2_regular/self","planning_path_boundary_1_fallback/self","candidate_path_fallback/self","planning_path_boundary_2_fallback/self"],o.planningData.path=a.filter((function(e){return!i.includes(e.name)}))),a=(null==o||null===(r=o.planningData)||void 0===r?void 0:r.path)||[],ne||(i=["planning_reference_line"],o.planningData.path=a.filter((function(e){return!i.includes(e.name)}))),!ie&&o.planningTrajectory&&(o.planningTrajectory=[]),o):o};(0,r.useEffect)((function(){if(M){var e=null,t=null;if(ce===Re.FOLLOW){y.removeAll(),y.view.setViewType("Overhead");var n=V({name:h.lt.SIM_WORLD,needChannel:!1});n&&(t=n.subscribe((function(e){if(e&&0!==Object.keys(e).length){var t={autoDrivingCar:e.autoDrivingCar,followPlanningData:e.planningTrajectory};y.updateData(t)}})))}if(ce===Re.DEFAULT){y.follow.dispose();var r=(0,w.throttle)((function(e){F.getRoutePath().then((function(t){if(m.current=e.routingTime,0!==Object.keys(e).length){var n=_t({},e);n.routePath=t.routePath,y.updateData(be(n)),null==y||y.pointCloud.updateOffsetPosition()}}))}),500,{leading:!0}),o=V({name:h.lt.SIM_WORLD,needChannel:!1});o&&(t=o.subscribe((function(e){if(e){var t=e.autoDrivingCar;if(t){var n,o,i=null!==(n=t.positionX)&&void 0!==n?n:0,a=null!==(o=t.positionY)&&void 0!==o?o:0,l=Math.abs(b.current[0]-i)+Math.abs(b.current[1]-a);I.debug("车辆偏移距离：".concat(l,", 阈值为100")),l>100&&0!==b.current[0]&&0!==b.current[1]&&y&&y.initialized&&(I.debug("车辆偏移距离超过阈值，重置场景"),y.resetScence()),b.current=[i,a]}0!==Object.keys(e).length&&(e.routingTime&&e.routingTime!==m.current?r(e):(y.updateData(be(e)),null==y||y.pointCloud.updateOffsetPosition()))}})));var i=V({name:h.lt.Map,needChannel:!1});i&&(e=i.subscribe((function(e){e&&(null==y||y.updateMap(e))})))}return de(),function(){ce===Re.FOLLOW&&(y.view.setViewType("Default"),t&&t.unsubscribe()),ce===Re.DEFAULT&&(e&&e.unsubscribe(),t&&t.unsubscribe());var n=fe.current;n&&cancelAnimationFrame(n)}}}),[ce,M,ne,Q,ie]);var ve=(0,R.A)().metadata,ge=(0,r.useMemo)((function(){return ve.find((function(e){return e.dataName===h.lt.POINT_CLOUD}))}),[ve,M]),he=(0,r.useMemo)((function(){return ge?ge.channels.map((function(e){return{label:null==e?void 0:e.channelName,value:null==e?void 0:e.channelName}})):[]}),[ge]),Ee=(0,r.useMemo)((function(){var e,t=null===(e=ve.find((function(e){return e.dataName===h.lt.POINT_CLOUD})))||void 0===e||null===(e=e.channels)||void 0===e?void 0:e.filter((function(e){return(null==e?void 0:e.channelName.includes("compensator"))||(null==e?void 0:e.channelName.includes("fusion"))})).sort((function(e){return null!=e&&e.channelName.includes("compensator")?-1:1}));return Array.isArray(t)?t[0]:""}),[ve]),we=(0,O.Mj)("".concat(L,"-viz-pointcloud-channel"));(0,r.useEffect)((function(){var e=null;if(M){var t=we.get();H&&t&&(e=V({name:h.lt.POINT_CLOUD,channel:t,needChannel:!0}))&&(pe.current=e.subscribe((function(e){e&&(null==y||y.updatePointCloud(e))})),J(t))}return function(){pe.current&&pe.current.unsubscribe(),y.pointCloud.disposeLastFrame()}}),[ve,H,M]),(0,r.useEffect)((function(){return function(){var e;null===(e=me.current)||void 0===e||null===(e=e.subscription)||void 0===e||e.unsubscribe()}}),[]);var Oe=r.createElement(D,{carviz:y,pointCloudFusionChannel:Ee,handlePointCloudVisible:G,curChannel:Z,setCurChannel:J,pointcloudChannels:he,updatePointcloudChannel:function(e){ye();var t=T.subscribeToDataWithChannel(h.lt.POINT_CLOUD,e).subscribe((function(e){e&&(null==y||y.updatePointCloud(e))}));me.current={name:h.lt.POINT_CLOUD,subscription:t}},closeChannel:ye,handleReferenceLineVisible:re,handleBoundaryLineVisible:ee,handleTrajectoryLineVisible:ae});return r.createElement("div",{className:s["viz-container"]},r.createElement("div",{id:d,className:s["web-gl"]}),r.createElement("div",{className:s["viz-btn-container"]},r.createElement(z.A,{carviz:y},r.createElement(i.AM,{placement:"leftTop",content:Oe,trigger:"click"},r.createElement("span",{className:s["viz-btn-item"]},r.createElement(i.Yx,null))),r.createElement(i.AM,{overlayClassName:s["layer-menu-popover"],placement:"leftBottom",content:r.createElement(_.A,{carviz:y,setCurrentView:k}),trigger:"click",style:{padding:"0 !importent"}},r.createElement("span",{className:s["viz-btn-item"]},null==C?void 0:C.charAt(0))))),r.createElement(Pe,null))}function Bt(){var e=zt(ye(),2)[1],t={routeOrigin:le.EDITING_ROUTE,routePoint:{routeInitialPoint:null,routeWayPoint:[]}},n={currentRouteLoop:{currentRouteLoopState:!1}};return(0,r.useEffect)((function(){e(mt({routeManager:new It(t,n)}))}),[]),r.createElement(d,{initialPath:"/"},r.createElement(v,{path:"/",style:{minWidth:"244px",height:"100%",position:"relative"}},r.createElement(Wt,null)),r.createElement(y,{path:"/routing",style:{width:"100%",height:"100%"}},r.createElement(Et,null)))}function Ut(){return r.createElement(de,null,r.createElement(Bt,null))}function Yt(e){var t=(0,r.useMemo)((function(){return(0,K.A)({PanelComponent:Ut,panelId:e.panelId})}),[]);return r.createElement(t,e)}Ut.displayName="VehicleViz";const $t=r.memo(Yt)}}]);