"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[773],{73994:(e,n,t)=>{t.r(n),t.d(n,{default:()=>x});var i=t(48431),r=t(99063),l=t(52016),a=t(47960),o=t(52274),u=t.n(o),c=t(36242),s=t(46533),b=t(84436),f=t(38129),d=t(96676),y=t(2975),p=t(83517),v=t(60346),m=t(11446),V={Perception:{polygon:{defaultVisible:!0,currentVisible:!0,vizKey:"polygon"},boundingbox:{defaultVisible:!1,currentVisible:!1,vizKey:"boundingbox"},pointCloud:{defaultVisible:!0,currentVisible:!0,vizKey:"pointCloud"},unknownMovable:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownMovable"},vehicle:{defaultVisible:!0,currentVisible:!0,vizKey:"vehicle"},unknownStationary:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownUnmovable"},pedestrian:{defaultVisible:!0,currentVisible:!0,vizKey:"pedestrian"},unknown:{defaultVisible:!0,currentVisible:!0,vizKey:"unknown"},bicycle:{defaultVisible:!0,currentVisible:!0,vizKey:"bicycle"},cipv:{defaultVisible:!0,currentVisible:!0,vizKey:"cipv"},velocity:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleVelocity"},heading:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleHeading"},id:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleId"},distanceAndSpeed:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleDistanceAndSpeed"},laneMarker:{defaultVisible:!0,currentVisible:!0,vizKey:"laneMarker"},lidarSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"lidarSensor"},radarSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"radarSensor"},cameraSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"cameraSensor"},v2x:{defaultVisible:!0,currentVisible:!0,vizKey:"v2x"}},Prediction:{priority:{defaultVisible:!1,currentVisible:!1,vizKey:"obstaclePriority"},majorPredictionLine:{defaultVisible:!1,currentVisible:!1,vizKey:"majorPredictionLine"},gaussianInfo:{defaultVisible:!1,currentVisible:!1,vizKey:"gaussianInfo"},minorPredictionLine:{defaultVisible:!1,currentVisible:!1,vizKey:"minorPredictionLine"},interactiveTag:{defaultVisible:!1,currentVisible:!1,vizKey:"obstacleInteractiveTag"}},Routing:{routingLine:{defaultVisible:!1,currentVisible:!1,vizKey:"routingLine"}},Decision:{mainDecision:{defaultVisible:!1,currentVisible:!1,vizKey:"mainDecision"},obstacleDecision:{defaultVisible:!1,currentVisible:!1,vizKey:"obstacleDecision"}},Planning:{planningCar:{defaultVisible:!1,currentVisible:!1,vizKey:"planningCar"},planningTrajectory:{defaultVisible:!1,currentVisible:!1,vizKey:"planningTrajectory"}},Position:{localization:{defaultVisible:!0,currentVisible:!0,vizKey:"localization"},gps:{defaultVisible:!1,currentVisible:!1,vizKey:"gps"},shadow:{defaultVisible:!1,currentVisible:!1,vizKey:"shadow"}},Map:{crosswalk:{defaultVisible:!1,currentVisible:!1,vizKey:"crosswalk"},clearArea:{defaultVisible:!1,currentVisible:!1,vizKey:"clearArea"},junction:{defaultVisible:!1,currentVisible:!1,vizKey:"junction"},pncJunction:{defaultVisible:!1,currentVisible:!1,vizKey:"pncJunction"},lane:{defaultVisible:!1,currentVisible:!1,vizKey:"lane"},road:{defaultVisible:!1,currentVisible:!1,vizKey:"road"},signal:{defaultVisible:!1,currentVisible:!1,vizKey:"signal"},stopSign:{defaultVisible:!1,currentVisible:!1,vizKey:"stopSign"},yieldSign:{defaultVisible:!1,currentVisible:!1,vizKey:"yieldSign"},speedBump:{defaultVisible:!1,currentVisible:!1,vizKey:"speedBump"},parkingSpace:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpace"},parkingSpaceId:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpaceId"},laneId:{defaultVisible:!1,currentVisible:!1,vizKey:"laneId"}}},g=function(e){var n={};return Object.keys(e).forEach((function(t){var i=e[t];Object.keys(i).forEach((function(e){var r=i[e];n[t]=n[t]||{},n[t][r.vizKey]=r.currentVisible}))})),n},h=new m.DT(m.qK.PointCloudLayerMenu),z=function(){return h.get()||V},S=t(1434);function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function w(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function E(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?w(Object(t),!0).forEach((function(n){O(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function O(e,n,t){var i;return i=function(e,n){if("object"!=K(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=K(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n),(n="symbol"==K(i)?i:String(i))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function C(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var i,r,l,a,o=[],u=!0,c=!1;try{if(l=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;u=!1}else for(;!(u=(i=l.call(t)).done)&&(o.push(i.value),o.length!==n);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw r}}return o}}(e,n)||function(e,n){if(e){if("string"==typeof e)return P(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?P(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function j(e){var n=(0,f.A)().classes,t=e.carviz,r=e.obstacleChannels,o=e.updateObstacleChannel,u=e.closeChannel,c=e.showPerception,s=e.setShowPerception,b=e.curChannel,d=e.setCurChannel,y=(0,a.Bd)("layerMenu").t,p=z();h.set(p),t.option.updateLayerOption(g(p),"pointCloud");var v=C((0,i.useState)(p),2),m=v[0],V=v[1],K=C((0,i.useState)(Object.keys(m)),1)[0],w=C((0,i.useState)(K[0]),1)[0],P=C((0,i.useState)(m[w]),2)[1];return i.createElement("div",{className:n["layer-menu-container"]},i.createElement("div",{className:n["layer-menu-content"]},i.createElement("div",{className:n["layer-menu-content-left"]},i.createElement("span",{className:n["layer-menu-content-right-switch"],style:{display:"inline-block",marginTop:"6px"}},i.createElement(l.Sc,{checked:c,defaultChecked:!0,onChange:function(e){e.target.checked&&r.length?(s(!0),o(b)):(s(!1),u())}})),y("perception")),i.createElement("div",{className:n["layer-menu-content-right"]},i.createElement(S.A,{value:b,options:r,onChange:function(e){return function(e){d(e),o(e)}(e)}}),i.createElement("div",{className:n["layer-menu-horizontal-line"]}),i.createElement("li",{className:n["layer-menu-content-right-li"]},i.createElement("span",{className:n["layer-menu-content-right-switch"]},i.createElement(l.sx,{checked:m.Perception.polygon.currentVisible,onChange:function(e){if(e.target.checked){var n=E(E({},m.Perception),{},{polygon:E(E({},m.Perception.polygon),{},{currentVisible:!0}),boundingbox:E(E({},m.Perception.boundingbox),{},{currentVisible:!1})}),i=E(E({},m),{},O({},w,n));P((function(){return n})),V((function(){return i})),t.option.updateLayerOption(g(i),"vehicle"),h.set(i)}}})),i.createElement("span",{className:n["layer-menu-content-right-label"]},y("polygon"))),i.createElement("li",{className:n["layer-menu-content-right-li"]},i.createElement("span",{className:n["layer-menu-content-right-switch"]},i.createElement(l.sx,{checked:m.Perception.boundingbox.currentVisible,onChange:function(e){if(e.target.checked){var n=E(E({},m.Perception),{},{polygon:E(E({},m.Perception.polygon),{},{currentVisible:!1}),boundingbox:E(E({},m.Perception.boundingbox),{},{currentVisible:!0})}),i=E(E({},m),{},O({},w,n));P((function(){return n})),V((function(){return i})),t.option.updateLayerOption(g(i),"vehicle"),h.set(i)}}})),i.createElement("span",{className:n["layer-menu-content-right-label"]},y("boundingbox"))))))}function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function D(e,n,t){var i;return i=function(e,n){if("object"!=k(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=k(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n),(n="symbol"==k(i)?i:String(i))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function A(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var i,r,l,a,o=[],u=!0,c=!1;try{if(l=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;u=!1}else for(;!(u=(i=l.call(t)).done)&&(o.push(i.value),o.length!==n);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw r}}return o}}(e,n)||function(e,n){if(e){if("string"==typeof e)return I(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?I(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function N(){var e=A((0,i.useState)(!0),2),n=e[0],t=e[1],o=A((0,i.useState)(null),2),v=o[0],m=o[1],V=(0,p.d)(),S=A((0,i.useState)(u().generate),1)[0],K=A((0,c.qZ)(),1)[0],w=V.initSubscription,E=V.setKeyDownHandlers,O=V.removeKeyDownHandlers,C=(0,f.A)().classes,P=A((0,i.useState)("D"),2),k=P[0],I=P[1],N=A((0,i.useState)((function(){return new r.o(S)})),1)[0],M=(0,a.Bd)("panels").t,x=A((0,i.useState)(null),2),L=x[0],T=x[1],R=(0,b.A)(),U=R.metadata,B=R.isMainConnected,_=R.streamApi,q=(0,i.useRef)(null),H=(0,i.useMemo)((function(){return U.find((function(e){return"obstacle"===e.dataName}))}),[U,B]),W=(0,i.useMemo)((function(){return H?H.channels.map((function(e){return{label:null==e?void 0:e.channelName,value:null==e?void 0:e.channelName}})):[]}),[H]),F=function(){null==N||N.updateData({object:[],autoDrivingCar:{}}),q.current&&q.current.subscription&&(q.current.subscription.unsubscribe(),q.current=null)},J=function(e){F();var n=_.subscribeToDataWithChannel("obstacle",e).subscribe((function(e){var n={CopyAutoDrivingCar:e.autoDrivingCar,object:e.obstacle||[]};null==N||N.updateData(n)}));q.current={name:"obstacle",subscription:n}};(0,i.useEffect)((function(){N.init();var e=z();h.set(e),N.option.updateLayerOption(g(e),"pointCloud")}),[]),(0,i.useEffect)((function(){var e=[{keys:["="],functionalKey:"ctrlKey",handler:function(e){var n;e.preventDefault(),null===(n=N.view)||void 0===n||n.updateViewDistance(-10)},discriptor:M("zoomIn")},{keys:["="],functionalKey:"metaKey",handler:function(e){var n;e.preventDefault(),null===(n=N.view)||void 0===n||n.updateViewDistance(-10)},discriptor:M("zoomIn")},{keys:["-"],functionalKey:"ctrlKey",handler:function(e){var n;e.preventDefault(),null===(n=N.view)||void 0===n||n.updateViewDistance(10)},discriptor:M("zoomOut")},{keys:["-"],functionalKey:"metaKey",handler:function(e){var n;e.preventDefault(),null===(n=N.view)||void 0===n||n.updateViewDistance(10)},discriptor:M("zoomOut")}];return E(e),function(){O(e)}}),[M]),(0,i.useEffect)((function(){if(W&&0!==W.length&&_){var e=W[0];m(e.value),n&&J(e.value)}}),[W,_]),(0,i.useEffect)((function(){return function(){var e;null===(e=q.current)||void 0===e||null===(e=e.subscription)||void 0===e||e.unsubscribe()}}),[]),(0,i.useEffect)((function(){w(D(D({},s.lt.SIM_WORLD,{consumer:function(e){N.updateData(e)}}),s.lt.POINT_CLOUD,{consumer:function(e){T(e)}}))}),[]),(0,i.useEffect)((function(){L&&(null==N||N.updatePointCloud(L))}),[L]);var $=(0,i.useRef)(0),Y=function e(){null==N||N.render(),$.current=requestAnimationFrame(e)};(0,i.useEffect)((function(){return Y(),function(){var e=$.current;e&&cancelAnimationFrame(e)}}),[]),(0,i.useEffect)((function(){T(null),null==N||N.removeAll()}),[K.currentRecordId]);var Z=i.createElement(j,{curChannel:v,setCurChannel:m,carviz:N,obstacleChannels:W,updateObstacleChannel:J,closeChannel:F,showPerception:n,setShowPerception:t});return i.createElement("div",{className:C["viz-container"]},i.createElement("div",{id:S,className:C["web-gl"]}),i.createElement("div",{className:C["viz-btn-container"]},i.createElement(y.A,{carviz:N},i.createElement(l.AM,{placement:"leftTop",trigger:"click",content:Z},i.createElement("span",{className:C["viz-btn-item"]},i.createElement(l.Yx,null))),i.createElement(l.AM,{placement:"leftTop",content:i.createElement(d.A,{carviz:N,setCurrentView:I}),trigger:"click"},i.createElement("span",{className:C["viz-btn-item"]},k)))))}function M(e){var n=(0,i.useMemo)((function(){return(0,v.A)({PanelComponent:N,panelId:e.panelId,subscribeInfo:[{name:s.lt.POINT_CLOUD,needChannel:!0},{name:s.lt.SIM_WORLD,needChannel:!1}]})}),[]);return i.createElement(n,e)}N.displayName="PointCloud";const x=i.memo(M)}}]);